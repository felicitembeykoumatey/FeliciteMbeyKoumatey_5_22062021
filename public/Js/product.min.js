let params = new URL(document.location).searchParams,
  id = params.get("id");
const varnishElt = document.getElementById("varnish-select");
console.log("varnishElt:" + varnishElt);
const titleElt = document.getElementById("titre");
console.log("titleElt:" + titleElt);
const priceElt = document.getElementById("prix");
console.log("priceElt:" + priceElt);
const descriptionElt = document.getElementById("description");
console.log("descriptionElt:" + descriptionElt);
const imageElt = document.getElementById("image");
console.log("imageElt:" + imageElt);
const quantityElt = document.getElementById("quantityProduct");

function main() {
  getArticles(), addToBasket();
}
function getArticles() {
  fetch(`http://localhost:3000/api/furniture/${id}`)
    .then(function (response) {
      return response.json();
    })
    .catch((e) => {
      document.getElementById("container").innerHTML =
        "oups! Lancez le serveur local au Port 3000 !";
    })
    .then(function (element) {
      (titleElt.textContent = element.name),
        (priceElt.textContent = element.price / 100 + " €"),
        (descriptionElt.textContent = element.description),
        (imageElt.src = element.imageUrl);

      let optionVarnish = element.varnish;
      console.log("optionVarnish:" + optionVarnish);
      let structureOptions = [];
      for (let varnish = 0; varnish < optionVarnish.length; varnish++)
        (structureOptions += `<option value="${varnish + 1}">${
          optionVarnish[varnish]
        }</option>`),
          (varnishElt.innerHTML = structureOptions),
          console.log("varnishElt.innerHTML:" + varnishElt.innerHTML);
    });
}
function addToBasket() {
  const addToBasket = document.getElementById("add-to-basket");
  console.log("addToBasket:" + addToBasket),
    addToBasket.addEventListener("click", () => {
      if (
        (alert("Votre article a été ajouté au panier"),
        null != varnishElt && null != quantityElt)
      ) {
        console.log("hello if");
        let productAdded = {
          name: titleElt.textContent,
          price: priceElt.textContent,
          varnish: varnishElt.value,
          quantity: quantityElt.value,
          _id: id,
        };
        console.log("productAdded:" + productAdded);

        let arrayProductsInCart = [];

        // Si le localStorage existe, on récupère son contenu, on l'insère dans le tableau arrayProductsInCart, puis on le renvoit vers le localStorage avec le nouveau produit ajouté.
        if (localStorage.getItem("products") !== null) {
          arrayProductsInCart = JSON.parse(localStorage.getItem("products"));

          // Si le LS est vide, on le crée avec le produit ajouté
        }
        arrayProductsInCart.push(productAdded);
        localStorage.setItem("products", JSON.stringify(arrayProductsInCart));
      }
    });
}
console.log("quantityElt:" + quantityElt),
  main(),
  console.log("addEventlistener:" + addEventListener);
