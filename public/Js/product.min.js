let params = new URL(document.location).searchParams,
  id = params.get("id");
const varnishElt = document.getElementById("varnish-select");
console.log(varnishElt);
const titleElt = document.getElementById("titre");
const priceElt = document.getElementById("prix");
const descriptionElt = document.getElementById("description");
const imageElt = document.getElementById("image");
const quantityElt = document.getElementById("quantity-product");
const addToBasket = document.getElementById("add-to-basket");
const textConfirmation = document.getElementById("confirmation-ajout");

fetch(`http://localhost:3000/api/furniture/${id}`)
  .then(function (response) {
    return response.json();
  })
  .catch((e) => {
    document.getElementById("product").innerHTML =
      "oups! Lancez le serveur local au Port 3000 !";
  })
  .then(function (furniture) {
    console.log(furniture);
    article = furniture;
    imageElt.src = article.imageUrl;
    titleElt.innerHTML = article.name;
    descriptionElt.innerText = article.description;

    // Formatage du prix pour l'afficher en euros
    article.price = article.price / 100;
    priceElt.innerText = new Intl.NumberFormat("fr-FR", {
      style: "currency",
      currency: "EUR",
    }).format(article.price);

    let optionVarnish = furniture.varnish;

    let structureOptions = [];
    for (let varnish = 0; varnish < optionVarnish.length; varnish++) {
      structureOptions += `<option value="${optionVarnish[varnish]}">${optionVarnish[varnish]}</option>`;
      varnishElt.innerHTML = structureOptions;
    }

    console.log("for");

    // Ecouter les évenements

    addToBasket.addEventListener("click", (event) => {
      event.preventDefault();

      if (quantityElt.value > 0 && quantityElt.value < 100) {
        let productAdded = {
          article: titleElt.innerHTML,
          _id: id,
          price: parseFloat(priceElt.innerHTML),
          quantity: parseFloat(
            document.getElementById("quantity-product").value
          ),
        };
        // Gestion LocalStorage

        let basket = [];
        //si l'article est dans le LS, on recupère son contenu, on l'insère dans le tableau basket, puis on le renvoit vers le LS avec le nouveau article.

        if (localStorage.getItem("products") !== null) {
          basket = JSON.parse(localStorage.getItem("products"));

          // sinon, on le crée avec l'article ajouté
        }
        basket.push(productAdded),
          localStorage.setItem("products", JSON.stringify(basket));

        alert("Votre article a été ajouté au panier");
      }
    });
  });
console.log(JSON);
console.log("hello if");
