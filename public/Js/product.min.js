let params = new URL(document.location).searchParams,
  id = params.get("id");
const varnishElt = document.getElementById("varnish-select");
const titleElt = document.getElementById("titre");
const priceElt = document.getElementById("prix");
const descriptionElt = document.getElementById("description");
const imageElt = document.getElementById("image");
const quantityElt = document.getElementById("quantityProduct");

fetch(`http://localhost:3000/api/furniture/${id}`)
  .then(function (response) {
    return response.json();
  })
  .catch((e) => {
    document.getElementById("container").innerHTML =
      "oups! Lancez le serveur local au Port 3000 !";
  })
  .then(function (furniture) {
    (titleElt.textContent = furniture.name),
      (priceElt.textContent = furniture.price / 100 + " €"),
      (descriptionElt.textContent = furniture.description),
      (imageElt.src = furniture.imageUrl);

    let optionVarnish = furniture.varnish;

    let structureOptions = [];
    for (let varnish = 0; varnish < optionVarnish.length; varnish++) {
      structureOptions += `<option value="${varnish + 1}"${
        optionVarnish[varnish]
      }
      
     </option>`;
      varnishElt.innerHTML = structureOptions;
    }
    const addToBasket = document.getElementById("add-to-basket");

    addToBasket.addEventListener("click", () => {
      basket = JSON.parse(localStorage.getItem("products"));

      if (basket) {
        let productAdded = {
          name: titleElt.textContent,
          price: priceElt.textContent,
          quantity: quantityElt.value,
          varnish: varnishElt.value,
          _id: id,
        };

        let basket = [];

        basket.push(productAdded),
          localStorage.setItem("products", JSON.stringify(basket));
      }
      alert("Votre article a été ajouté au panier");
    });
  });
console.log(JSON);
console.log("hello if");
