//déclaration variables
const formulaireElt = document.getElementById("formulaire");
const totalPriceElt = document.getElementById("total-price");
const productName = document.getElementById("articleName");
const priceElt = document.getElementById("articlePrice");
const quantityElt = document.getElementById("articleQty");
const basketELt = document.getElementById("container-recapitulatif");
console.log(basketELt);

const positionElt = document.getElementById("articles");

const validation = document.getElementById("validate");

//--------affichage produit selectionner

//Déclaration de la variable "basket"dans laquelle on met les key et les values.
let basket = JSON.parse(window.localStorage.getItem("products"));

pageBasket();

function pageBasket() {
  // si le panier est vide
  if (basket === null) {
    const panierVide = `<main id="container-products-basket"><div class="empty-basket">Le panier est vide !</div></main>`;
    positionElt.innerHTML = panierVide;
  } else {
    //si le panier n'est pas vide: afficher les produits dans le LS
    let structureProductBasket = [];

    //faire boucle for pour parcourir mon LS et recupérer les objets

    for (k = 0; k < basket.length; k++) {
      structureProductBasket += `<div class="quantity"> Qauntité - ${basket[k].quantity}</div>
      <div class="name">  ${basket[k].article}</div> <div class="price">${basket[k].price} € - <button class="btn-delete">Supprimer</button></div>
`;
    }

    if (k == basket.length) {
      // injection html dans la page panier
      positionElt.innerHTML = structureProductBasket;
    }
  }
}
//-----------Fin de l'affichage des produits du panier-----------------------------------

//******************Gestion du bouton supprimer l'article*******************************************/

//---------------Sélection des références de tous les boutons btn-supprimer----------------------------------------

const btnDelete = document.querySelectorAll("btn-delete");
console.log(btnDelete);

//*************************************Le bouton pour vider le panier************************************************************************** */

////*********************************Le montant total du panier ******************************************************/
let priceTotalCalcul = [];
//Aller chercher les prix dans le panier
console.log("priceTotalCalcul:" + priceTotalCalcul);
for (let m = 0; m < basket.length; m++) {
  let priceProductInBasket = basket[m].price;
  //mettre les prix du panier dans la variable "priceTotalCalcul"

  priceTotalCalcul.push(priceProductInBasket);
  console.log("priceTotalCalcul");
}

// Additionner les prix qu'il ya dans le tableau de la variable "prix totale"---------
const reducer = (accumulator, currentValue) => accumulator + currentValue;
const totalPrice = priceTotalCalcul.reduce(reducer, 0);
console.log("totalPrice:" + totalPrice);
console.log(reducer);

// le code html du prix total à afficher

const affichagePrixHtml = `

<div class ="affichage-prix-html">${totalPrice} € </div>`;
totalPriceElt.insertAdjacentHTML("beforeend", affichagePrixHtml);

console.log("affrichePrixHtml");

structureFormulaire = "";

// Sélection élément DOM pour le positionnement du formulaire
const afficherFormulaireHtml = () => {
  const positionElt4 = document.getElementById("container");
  const structureFormulaire = `
  

   <section class="formulaire-section">
          <h2>Vos coordonnées</h2>

          <form id="contact" class="card-body">

            <label for="firstName">Prénom</label>
            <input type="text" id="firstName" placeholder="Prénom" />

            <label for="lastName">Nom</label>
            <input type="text" id="lastName" placeholder="Name" />


            <label for="email">Email</label>

            <input type="email" id="email" placeholder="Email" />



            <label for="address">Adresse</label>

            <input id="address" placeholder="Adresse" />


            <label for="city">Ville</label>
            <input type="text" id="city" placeholder="Ville" />

            <label for="postal">Code Postal</label>

            <input type="text" id="postal" placeholder="Code postal" />

            <!--Fin forumlaire dans le HTML-->
            


          </form>
           <button id="btn-order" class="validate-order>
          <a href="../view/order.html" id="validate" class="validation"
            >Valider ma Commande</a
          >
        </button>

            <button class="continue-shopping"><a href="../index.html">Continuer mes achats</a></button>
        </section>
      </div>
  
  `;

  //----------------Injection HTML----------------------------------------
  positionElt4.insertAdjacentHTML("afterend", structureFormulaire);

  // Récupération des valeurs du formulaire pour les mettre dans le localStorage
  localStorage.setItem("prenom", document.getElementById("firstName").value);
};
afficherFormulaireHtml();
//-------------------------bouton envoyer le formulaire--------------------------------------------------------------
const btnOrderElt = document.getElementById("btn-order");
//-----------------------------AddEventListener-------------------------------------------------------------
btnOrderElt.addEventListener("click", (e) => {
  e.preventDefault();

  //Récupération des valeurs du formulaire pour les mettre dans le LS

  localStorage.setItem("firstName", document.getElementById("firstName").value);
  localStorage.setItem("lastName", document.getElementById("lastName").value);
  localStorage.setItem("email", document.getElementById("email").value);
  localStorage.setItem("address", document.getElementById("address").value);
  localStorage.setItem("city", document.getElementById("city").value);
  localStorage.setItem("postal", document.getElementById("postal").value);

  const formulaire = {
    firstName: localStorage.getItem("firstname"),
    lastName: localStorage.getItem("lastName"),
    email: localStorage.getItem("email"),
    adress: localStorage.getItem("address"),
    city: localStorage.setItem("city"),
    codePostal: localStorage.getItem("postal"),
  };
  console.log(formulaire);
  //Mettre les values du formulaire et mettre les produits selectionnés dans un objet à envoyer ver le serveur
  const aEnvoyer = {
    basket,
    formulaire,
  };
  console.log(aEnvoyer);
});
